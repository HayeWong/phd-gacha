<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>博士日常扭蛋机 v1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 780px;
      padding: 24px 20px 18px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 24px;
    }

    .subtitle {
      margin: 0 0 20px;
      font-size: 13px;
      color: #9ca3af;
    }

    .status-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .status-item {
      font-size: 12px;
    }

    .status-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .status-name {
      color: #9ca3af;
    }

    .status-value {
      color: #e5e7eb;
    }

    .bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid #111827;
    }

    .bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 50%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transition: width 0.25s ease;
    }

    .bar-fill.stress {
      background: linear-gradient(90deg, #f97316, #ef4444);
    }

    .bar-fill.thesis {
      background: linear-gradient(90deg, #38bdf8, #6366f1);
    }

    .bar-fill.paper {
      background: linear-gradient(90deg, #14b8a6, #22d3ee);
    }

    .bar-fill.death {
      background: linear-gradient(90deg, #a855f7, #ec4899);
    }

    .controls {
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      background: #4f46e5;
      color: white;
      white-space: nowrap;
    }

    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }

    button:hover:not([disabled]) {
      filter: brightness(1.05);
    }

    button:active:not([disabled]) {
      transform: translateY(1px);
    }

    .counter {
      font-size: 12px;
      color: #9ca3af;
    }

    .event-box {
      margin-top: 10px;
      padding: 16px 14px;
      border-radius: 14px;
      background: #020617;
      border: 1px solid #374151;
      min-height: 80px;
    }

    .event-title {
      font-size: 13px;
      font-weight: 600;
      color: #a5b4fc;
      margin-bottom: 6px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .event-text {
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-line;
    }

    .hidden {
      display: none;
    }

    .ending-box {
      margin-top: 16px;
      padding: 14px 14px 12px;
      border-radius: 12px;
      background: #111827;
      border: 1px solid #4b5563;
      font-size: 13px;
    }

    .ending-title {
      font-weight: 600;
      margin: 0 0 6px;
      color: #fbbf24;
    }

    footer {
      margin-top: 18px;
      font-size: 11px;
      color: #6b7280;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>博士日常扭蛋机 v1.0</h1>
    <p class="subtitle">
      你可以开始读博了。
    </p>

    <div class="status-row">
      <div class="status-item">
        <div class="status-label">
          <span class="status-name">SAN 值</span>
          <span class="status-value" id="sanValue">60</span>
        </div>
        <div class="bar">
          <div class="bar-fill" id="sanBar"></div>
        </div>
      </div>

      <div class="status-item">
        <div class="status-label">
          <span class="status-name">压力值</span>
          <span class="status-value" id="stressValue">20</span>
        </div>
        <div class="bar">
          <div class="bar-fill stress" id="stressBar"></div>
        </div>
      </div>

      <div class="status-item">
        <div class="status-label">
          <span class="status-name">大论文进度</span>
          <span class="status-value" id="thesisValue">0</span>
        </div>
        <div class="bar">
          <div class="bar-fill thesis" id="thesisBar"></div>
        </div>
      </div>

      <div class="status-item">
        <div class="status-label">
          <span class="status-name">小论文接收</span>
          <span class="status-value" id="paperValue">0 篇</span>
        </div>
        <div class="bar">
          <div class="bar-fill paper" id="paperBar"></div>
        </div>
      </div>

      <div class="status-item">
        <div class="status-label">
          <span class="status-name">“读博读的想死”</span>
          <span class="status-value" id="deathValue">0</span>
        </div>
        <div class="bar">
          <div class="bar-fill death" id="deathBar"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="drawBtn">抽取今日事件</button>
      <div class="counter">
        第 <span id="day">1</span> 天 · 已抽 <span id="count">0</span> 次
      </div>
    </div>

    <div id="eventBox" class="event-box hidden">
      <div class="event-title">今日事件</div>
      <p id="eventText" class="event-text"></p>
    </div>

    <div id="endingBox" class="ending-box hidden">
      <p class="ending-title" id="endingTitle"></p>
      <p id="endingText"></p>
      <button id="restartBtn">重新开始本轮博士人生</button>
    </div>

    <footer>
      如有雷同，纯属博士生活的样本方差不大。
    </footer>
  </div>

  <script>
    // 初始状态
    const initialState = {
      san: 60,
      stress: 20,
      thesis: 0,
      smallPapers: 0,
      deathWish: 0,
      day: 1,
      draws: 0,
      ended: false
    };

    const state = { ...initialState };
    const MAX_SMALL_PAPERS_FOR_BAR = 3;

    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    // 事件池：你的所有事件 + 小论文接收 + 需要 smallPapers>=1 的事件
    const events = [
      {
        id: 1,
        text: "你决定今天一定要写完一节正文。",
        sanDelta: +3,
        stressDelta: +4,
        thesisDelta: +10,
        deathDelta: -2,
        paperDelta: 0
      },
      {
        id: 2,
        text: "导师在群里发：“各位最近的进展可以简单汇报一下吗？”你花两个小时斟酌了 50 个字。",
        sanDelta: -2,
        stressDelta: +7,
        thesisDelta: +3,
        deathDelta: +4,
        paperDelta: 0
      },
      {
        id: 3,
        text: "你准备认真看一篇文献，用了三十分钟找 PDF，又花三十分钟纠结要不要记笔记，然后去刷手机了。",
        sanDelta: -3,
        stressDelta: +4,
        thesisDelta: 0,
        deathDelta: +3,
        paperDelta: 0
      },
      {
        id: 4,
        text: "你打开 Forest 定了 3 小时的倒计时，然后在学习 5 分钟后用网页刷起了小红书。",
        sanDelta: -3,
        stressDelta: +5,
        thesisDelta: +1,
        deathDelta: +3,
        paperDelta: 0
      },
      {
        id: 5,
        text: "在走廊遇到导师，装作没看见，你低头绕走了。",
        sanDelta: -2,
        stressDelta: +4,
        thesisDelta: 0,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 6,
        text: "你本来打算早点睡，结果为了安慰自己“今天也不是完全没干活”，在睡前打开了 Zotero。",
        sanDelta: -1,
        stressDelta: +3,
        thesisDelta: +2,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 7,
        text: "打开前两个月写下的草稿，发现完全看不懂自己在写什么。",
        sanDelta: -4,
        stressDelta: +4,
        thesisDelta: 0,
        deathDelta: +4,
        paperDelta: 0
      },
      {
        id: 8,
        text: "你花了半天时间帮本科生改作业，突然意识到自己论文都没开题。",
        sanDelta: -2,
        stressDelta: +5,
        thesisDelta: +1,
        deathDelta: +3,
        paperDelta: 0
      },
      {
        id: 9,
        text: "你看到同门在朋友圈发“新文 under review”，你关掉朋友圈，打开外卖软件。",
        sanDelta: -3,
        stressDelta: +4,
        thesisDelta: 0,
        deathDelta: +5,
        paperDelta: 0
      },
      {
        id: 10,
        text: "你点开邮件，发现三周前鼓起勇气给大牛写的那封长邮件，依旧没有得到回复。",
        sanDelta: -3,
        stressDelta: +3,
        thesisDelta: 0,
        deathDelta: +4,
        paperDelta: 0
      },
      {
        id: 11,
        text: "系里举行学术讲座，你全程听懂了开头的寒暄和结尾的“时间关系，我就讲到这里”。",
        sanDelta: -1,
        stressDelta: +1,
        thesisDelta: +1,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 12,
        text: "你在写作软件里统计字数，发现删掉的比写出来的还多。",
        sanDelta: -3,
        stressDelta: +3,
        thesisDelta: +1,
        deathDelta: +3,
        paperDelta: 0
      },
      {
        id: 13,
        text: "你安慰自己今天状态不好，决定明天再开始。",
        sanDelta: +1,
        stressDelta: +1,
        thesisDelta: 0,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 14,
        text: "你在自习室默默学习一整天，晚上回宿舍被问“你最近好像挺闲的”。",
        sanDelta: -2,
        stressDelta: +3,
        thesisDelta: +4,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 15,
        text: "你准备好好休息一天，结果导师发来一篇新文献让你“顺便看看”。",
        sanDelta: -2,
        stressDelta: +5,
        thesisDelta: +2,
        deathDelta: +3,
        paperDelta: 0
      },
      {
        id: 16,
        text: "你尝试向别人解释你的课题，对方认真听完之后问：“那以后能找什么工作？”",
        sanDelta: -3,
        stressDelta: +4,
        thesisDelta: 0,
        deathDelta: +4,
        paperDelta: 0
      },
      {
        id: 17,
        text: "你刷到学妹发朋友圈：拿了国家奖学金，手上还有三篇在投的小论文。",
        sanDelta: -4,
        stressDelta: +6,
        thesisDelta: 0,
        deathDelta: +8,
        paperDelta: 0
      },
      {
        id: 18,
        text: "你突然理顺了一段核心论证，一口气写了 1200 字，还给导师发了更新邮件。",
        sanDelta: +6,
        stressDelta: +2,
        thesisDelta: +18,
        deathDelta: -6,
        paperDelta: 0
      },
      {
        id: 19,
        text: "一位你很信任的老师认真看了你的稿子，告诉你：这东西是有潜力的。",
        sanDelta: +5,
        stressDelta: -2,
        thesisDelta: +6,
        deathDelta: -5,
        paperDelta: 0
      },
      {
        id: 20,
        text: "你为了给一条脚注找原文，沿着引文追溯了四篇文章，最后发现这句话根本没人真正说过。",
        sanDelta: -1,
        stressDelta: +3,
        thesisDelta: +2,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 21,
        text: "你去打印店打报销材料，看到前面的人在装订毕业论文，扉页上的“某某博士学位论文”让你心率短暂失常。",
        sanDelta: -1,
        stressDelta: +4,
        thesisDelta: +2,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 22,
        text: "你收到审稿意见：R&R。三个评审里，一个说“太激进”，一个说“太保守”，还有一个说“完全没观点”。",
        sanDelta: +1,
        stressDelta: +5,
        thesisDelta: +3,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 23,
        text: "你在寝室床上刷手机刷到半夜两点，突然冒出一个好点子，打开电脑准备写下来。",
        sanDelta: +1,
        stressDelta: +2,
        thesisDelta: +3,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 24,
        text: "你花了一下午改格式，把中文引号全部换成英文，引文全部统一为作者-年份制，正文一个字没动。",
        sanDelta: -1,
        stressDelta: +2,
        thesisDelta: 0,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 25,
        text: "你接到导师电话，对方只问了一句：“最近还好吧？”你一口气汇报了十五分钟进展，对方说：“那就这样。”",
        sanDelta: -1,
        stressDelta: +4,
        thesisDelta: +2,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 26,
        text: "你去旁听别的专业的博士开题会，发现他们的焦虑和你的焦虑高度同构，只是用的术语不一样。",
        sanDelta: +1,
        stressDelta: -1,
        thesisDelta: 0,
        deathDelta: -1,
        paperDelta: 0
      },
      {
        id: 27,
        text: "你被拉进一个新的微信群，群名叫“XX研究讨论组”，前七百条消息全是“已加”“欢迎欢迎”“辛苦老师”。",
        sanDelta: 0,
        stressDelta: +1,
        thesisDelta: 0,
        deathDelta: 0,
        paperDelta: 0
      },
      {
        id: 28,
        text: "你在食堂排队，看见前面两位博士生在讨论基金申请，你把耳机音量悄悄调小了一格。",
        sanDelta: -1,
        stressDelta: +2,
        thesisDelta: 0,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 29,
        text: "你为了推迟开始写今天的正文，甚至去认真打扫了宿舍，把桌面擦得一尘不染。",
        sanDelta: +1,
        stressDelta: +1,
        thesisDelta: 0,
        deathDelta: +1,
        paperDelta: 0
      },
      {
        id: 30,
        text: "你参加读书会，轮到你发言时，你熟练地用一些高级术语重复了作者原话，没人听出来你其实没读完那一章。",
        sanDelta: +1,
        stressDelta: -1,
        thesisDelta: +1,
        deathDelta: 0,
        paperDelta: 0
      },
      {
        id: 31,
        text: "你为了验证一个直觉，去查了十几篇实证研究，最后得出的结论是：“学界没有共识”。",
        sanDelta: -1,
        stressDelta: +2,
        thesisDelta: +2,
        deathDelta: +2,
        paperDelta: 0
      },
      {
        id: 32,
        text: "你在宿舍楼下遇到刚入学的硕士生，对方向你咨询申请博士的经验，你思考了三秒钟，说：“先别急。”",
        sanDelta: +1,
        stressDelta: 0,
        thesisDelta: 0,
        deathDelta: -1,
        paperDelta: 0
      },
      {
        id: 33,
        text: "你给自己放了一天假，什么也不做，晚上突然意识到：这可能是你最近效率最高的一天。",
        sanDelta: +3,
        stressDelta: -4,
        thesisDelta: 0,
        deathDelta: -2,
        paperDelta: 0
      },
      {
        id: 34,
        text: "你把一段中文翻成英文，又从英文翻回中文，发现回来的版本比你原来写得清楚，你有点不爽。",
        sanDelta: +1,
        stressDelta: +1,
        thesisDelta: +2,
        deathDelta: 0,
        paperDelta: 0
      },
      {
        id: 35,
        text: "你终于把一篇小论文投出去，点下提交按钮后感到前所未有的轻松。",
        sanDelta: +4,
        stressDelta: -3,
        thesisDelta: +3,
        deathDelta: -2,
        paperDelta: 0
      },
      // 小论文接收事件：只有达到一定进度/时间才可能发生
      {
        id: 36,
        text: "你收到期刊邮件，小论文被正式接收。你盯着“accepted”这行字看了整整五分钟。",
        sanDelta: +7,
        stressDelta: -5,
        thesisDelta: +4,
        deathDelta: -6,
        paperDelta: +1,
        condition(state) {
          return state.thesis >= 20 && state.day >= 10 && state.smallPapers < 3;
        }
      },
      // 需要 smallPapers>=1 才会触发的事件
      {
        id: 37,
        text: "你在一场跨校读书会上认识一个研究类似方向的人，两人加完微信，互相说“以后可以多交流”，然后谁都没再说话。",
        sanDelta: +2,
        stressDelta: +1,
        thesisDelta: +2,
        deathDelta: -1,
        paperDelta: 0,
        condition(state) {
          return state.smallPapers >= 1;
        }
      },
      {
        id: 38,
        text: "你被同门拉去小酒馆吐槽学术圈，从制度骂到期刊，从导师骂到评审，骂完大家心情都好了不少。",
        sanDelta: +3,
        stressDelta: -6,
        thesisDelta: 0,
        deathDelta: -2,
        paperDelta: 0
      },

      {
        id: 39,
        text: "你和很久不见的朋友去看了一场无关紧要的电影，出来之后谁也没提论文两个字。",
        sanDelta: +4,
        stressDelta: -7,
        thesisDelta: 0,
        deathDelta: -3,
        paperDelta: 0
      },
      {
        id: 40,
        text: "你晚上去操场走了几圈，顺便听了几段无脑播客，回寝室的时候突然觉得今天也还行。",
        sanDelta: +3,
        stressDelta: -5,
        thesisDelta: +1,
        deathDelta: -2,
        paperDelta: 0
      },
      {
        id: 41,
        text: "你和朋友在学校附近小饭馆点了一桌家常菜，互相抱怨完导师之后，谁也没劝谁“要坚持理想”。",
        sanDelta: +2,
        stressDelta: -4,
        thesisDelta: 0,
        deathDelta: -1,
        paperDelta: 0
      },
      {
        id: 42,
        text: "你回家待了一个周末，被家人当成还是那个什么都不用操心的小孩，论文话题被默契地略过了。",
        sanDelta: +5,
        stressDelta: -5,
        thesisDelta: -1,
        deathDelta: -3,
        paperDelta: 0
      },
      {
        id: 43,
        text: "你难得和同学去 KTV 嗨了一晚，第二天嗓子有点哑，但看到未读邮件的心率反应明显变迟钝了。",
        sanDelta: +2,
        stressDelta: -5,
        thesisDelta: 0,
        deathDelta: -1,
        paperDelta: 0
      },
      {
        id: 44,
        text: "你在操场慢跑时突然意识到：哪怕今天一个字没写，世界也照常转动，这个念头让你意外地放松。",
        sanDelta: +4,
        stressDelta: -6,
        thesisDelta: 0,
        deathDelta: -2,
        paperDelta: 0
      }
    ];

    function pickRandomEvent() {
      const candidates = events.filter(e => {
        if (typeof e.condition === "function") {
          return e.condition(state);
        }
        return true;
      });
      if (candidates.length === 0) {
        return null;
      }
      const index = Math.floor(Math.random() * candidates.length);
      return candidates[index];
    }

    function applyEvent(event) {
      // 压力越高，写作效率越低，但别降得太狠
      const slowFactor = Math.max(0.4, 1 - state.stress / 180);

      state.san = clamp(state.san + event.sanDelta, 0, 100);
      state.stress = clamp(state.stress + event.stressDelta, 0, 100);
      state.deathWish = clamp(state.deathWish + event.deathDelta, 0, 100);

      const thesisGain = Math.round(event.thesisDelta * slowFactor);
      state.thesis = clamp(state.thesis + thesisGain, 0, 100);

      if (event.paperDelta) {
        state.smallPapers = Math.max(0, state.smallPapers + event.paperDelta);
      }

      state.day += 1;
      state.draws += 1;
    }

    function updateUI() {
      const sanValue = document.getElementById("sanValue");
      const stressValue = document.getElementById("stressValue");
      const thesisValue = document.getElementById("thesisValue");
      const paperValue = document.getElementById("paperValue");
      const deathValue = document.getElementById("deathValue");

      const sanBar = document.getElementById("sanBar");
      const stressBar = document.getElementById("stressBar");
      const thesisBar = document.getElementById("thesisBar");
      const paperBar = document.getElementById("paperBar");
      const deathBar = document.getElementById("deathBar");

      const daySpan = document.getElementById("day");
      const countSpan = document.getElementById("count");

      sanValue.textContent = state.san;
      stressValue.textContent = state.stress;
      thesisValue.textContent = state.thesis;
      paperValue.textContent = state.smallPapers + " 篇";
      deathValue.textContent = state.deathWish;

      sanBar.style.width = state.san + "%";
      stressBar.style.width = state.stress + "%";
      thesisBar.style.width = state.thesis + "%";

      const paperRatio = Math.min(state.smallPapers, MAX_SMALL_PAPERS_FOR_BAR) / MAX_SMALL_PAPERS_FOR_BAR;
      paperBar.style.width = (paperRatio * 100) + "%";

      deathBar.style.width = state.deathWish + "%";

      daySpan.textContent = state.day;
      countSpan.textContent = state.draws;
    }

    function checkEnding() {
      const T = state.thesis;
      const P = state.smallPapers;
      const S = state.stress;
      const SAN = state.san;
      const D = state.deathWish;
      const Day = state.day;

      // 1. 抽身而退：想死值很高 + 论文没走一半 + 熬了一段时间
      if (D >= 100 ) {
        return {
          id: "exit",
          title: "结局：抽身而退",
          text:
            "你读博读的想死，你开始认真考虑退出目前的训练环境，于是你从光华楼上跃下，比纸张还轻，比墨水还淡\n\n" +
            "如果现实里也出现类似念头，这已经超出小游戏的处理能力范围，请尽快和现实中的人或专业机构谈一谈。"
        };
      }

      // 2. 精神崩溃：SAN 掉空、压力很高
      if (SAN <= 10 && S >= 70) {
        return {
          id: "collapse",
          title: "结局：精神崩溃",
          text:
            "任何一句“要不先休学调整一下状态”听起来都不再像玩笑。\n" +
            "你在宛平南路600号过上了梦寐以求的衣食无忧的日子，当然是家里帮你出的钱。"
        };
      }

      // 3. 学术倦怠：压力极高 + 论文迟迟不成型
      if (S >= 98 && T < 40 && Day >= 30 && D >= 60) {
        return {
          id: "burnout",
          title: "结局：学术倦怠",
          text:
            "大论文迟迟不成型。你开始认真研究退学流程说明"
        };
      }

      // 4. 人生才刚刚开始：高配好结局
      if (T >= 100 && P >= 2 && SAN >= 60 && S <= 70 && D <= 40) {
        return {
          id: "fresh_start",
          title: "结局：人生才刚刚开始",
          text:
            "你用了三年博士毕业，在 top985 教职和普本 100w 安家费加教授 title 之间选了前者。\n" +
            "但你不后悔。你知道，广阔天地，大有可为。\n" 
        };
      }

      // 5. 和气冲溶：看透体系又能自证价值
      if (T >= 100 && P >= 1 && SAN >= 50 && S >= 40 && S <= 85 && D >= 30 && D <= 70) {
        return {
          id: "heqi",
          title: "结局：和气冲溶",
          text:
            "你看透了体系的运行方式，也知道哪些地方必须妥协、哪些地方必须坚持。\n" +
            "你成为了大一新生口中那个课间会出去抽烟的酷导师"
        };
      }

      // 6. 片叶不沾身：项目书天赋
      if (T >= 60 && P >= 2 && SAN >= 40 && S >= 60 && D <= 50) {
        return {
          id: "project",
          title: "结局：片叶不沾身",
          text:
            "你发现自己并不热爱“真理”，但对“写项目书拿钱”有异乎寻常的天赋。\n" +
            "你拿到了几个数额可观的课题，成了系里为数不多可以大方发 RA 费的人。\n" +
            "你不再问“这是真的吗？”，而是先问“这好写吗？”"
        };
      }

      // 7. 回头看，当时的月亮：评审席上的你
      if (T >= 100 && P >= 3 && Day >= 30 && S >= 50 && S <= 90 && SAN >= 20 && SAN <= 70 && D >= 30 && D <= 70) {
        return {
          id: "reviewer",
          title: "结局：回头看，当时的月亮",
          text:
            "你坐在评审席位上，看着一摞摞年轻学者的申请书，开始给他们打 A、B、C。\n" +
            "某个深夜，你忽然意识到：你成了当年你在匿名审稿系统里猜测过无数次的那种人。"
        };
      }

      // 8. 会议永动机：飞来飞去的 academic life
      if (T >= 80 && P >= 1 && Day >= 25 && S >= 80 && D >= 30 && D <= 80 && SAN >= 20) {
        return {
          id: "conference",
          title: "结局：会议永动机",
          text:
            "你已经不太记得自己的博士论文在说什么，但你非常熟悉各大城市的会场、酒店和附近的咖啡馆。\n" +
            "你习惯于在不同的会议上用稍作修改的 PPT 讲类似的话题，在茶歇和人寒暄、交换名片、加微信。\n" +
            "偶尔，飞机降落时你会想：这算不算一种 academic life？"
        };
      }

      // 9. 乡镇文明人：三本教职生活
      if (T >= 80 && SAN >= 30 && S >= 50 && D >= 30 && D <= 70 && Day >= 20) {
        return {
          id: "town",
          title: "结局：乡镇文明人",
          text:
            "几轮申请、几次崩溃之后，你接受了一个三本学院的教职。\n" +
            "学院公众号需要你帮忙写“思政融入专业课”的示范案例，你每天在课堂上念 PPT，晚上回去在淘宝选电动按摩椅和泡脚桶。"
        };
      }

      // 10. 体面毕业：标准好结局
      if (T >= 100 && SAN >= 40 && S <= 80 && D <= 70) {
        return {
          id: "ok_grad",
          title: "结局：体面毕业",
          text:
            "你把大论文完整地交了上去。能不能拿到教职，你不敢想，但至少现在你还是毕业了。\n" +
            "你对学术既不狂热也不厌恶，只是把它当成一种可能的工作路径。"
        };
      }

      // 11. 疲惫毕业：学术阳痿
      if (T >= 100 && SAN < 40 && D >= 60) {
        return {
          id: "tired_grad",
          title: "结局：疲惫毕业",
          text:
            "你以不太健康的方式冲完了大论文，从形式上看一切顺利。\n" +
            "只是你已经不确定自己是否还愿意写任何学术文字，你确信自己患上了某种形式的“学术阳痿”。"
        };
      }

      // 12. 我们不再谈论月亮：彻底脱钩学术
      if (T >= 80 && P <= 1 && SAN >= 20 && SAN <= 60 && D >= 40 && D <= 85 && S >= 40) {
        return {
          id: "no_moon",
          title: "结局：我们不再谈论月亮",
          text:
            "你博士毕业后随便找了份工作，稳定、普通、可预期。\n" +
            "你知道，诺齐克、罗尔斯、巴特勒和伊利格瑞都离你很远了，你不太敢再翻开那些书，但也不再需要为此道歉。"
        };
      }

      return null;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const drawBtn = document.getElementById("drawBtn");
      const eventBox = document.getElementById("eventBox");
      const eventText = document.getElementById("eventText");
      const endingBox = document.getElementById("endingBox");
      const endingTitle = document.getElementById("endingTitle");
      const endingText = document.getElementById("endingText");
      const restartBtn = document.getElementById("restartBtn");

      updateUI();

      drawBtn.addEventListener("click", () => {
        if (state.ended) return;

        const event = pickRandomEvent();
        if (!event) {
          eventText.textContent = "今天什么也没发生。你在寝室里发呆了一整天。";
          eventBox.classList.remove("hidden");
          state.day += 1;
          state.draws += 1;
          updateUI();
          return;
        }

        eventText.textContent = event.text;
        eventBox.classList.remove("hidden");

        applyEvent(event);
        updateUI();

        const ending = checkEnding();
        if (ending) {
          state.ended = true;
          endingTitle.textContent = ending.title;
          endingText.textContent = ending.text;
          endingBox.classList.remove("hidden");
          drawBtn.disabled = true;
          drawBtn.textContent = "游戏已结束";
        }
      });

      restartBtn.addEventListener("click", () => {
        Object.assign(state, { ...initialState });
        updateUI();
        eventBox.classList.add("hidden");
        endingBox.classList.add("hidden");
        eventText.textContent = "";
        drawBtn.disabled = false;
        drawBtn.textContent = "抽取今日事件";
      });
    });
  </script>
</body>
</html>
